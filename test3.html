<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CyberChat Ads</title>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background: #0f0f0f; color: white; }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      color: #000;
      padding: 10px 20px;
    }
    .logo {
      font-size: 1rem;
      font-weight: bold;
    }
    .balance-btn {
      background: #90ee90;
      color: #000;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: default;
    }
    .hamburger {
      width: 30px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 5px;
    }
    .hamburger span {
      height: 4px;
      border-radius: 2px;
      background: black;
    }
    .hamburger span:nth-child(1) { width: 16px; }
    .hamburger span:nth-child(2) { width: 22px; }
    .hamburger span:nth-child(3) { width: 28px; }

    main {
      padding: 20px;
    }
    #chartContainer {
      margin-top: 20px;
      background: #0ff2;
      border-radius: 10px;
      padding: 20px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">CyberChat Ads</div>
    <button class="balance-btn">$0.000</button>
    <div class="hamburger" onclick="toggleMenu()">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </header>

  <main>
    <div id="chartContainer">
      <canvas id="adsChart"></canvas>
    </div>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
      authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
      databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
      projectId: "itzhoyoo-f9f7e",
      storageBucket: "itzhoyoo-f9f7e.filestorage.app",
      messagingSenderId: "1094792075584",
      appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
      measurementId: "G-LLT6F9WRKH"
    };

    firebase.initializeApp(firebaseConfig);

    const db = firebase.database();
    const ctx = document.getElementById('adsChart').getContext('2d');

    const adsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Ad Views',
            borderColor: '#00ffff',
            backgroundColor: '#00ffff44',
            data: [],
            fill: true,
            tension: 0.4,
          },
          {
            label: 'Ad Clicks',
            borderColor: '#00ff88',
            backgroundColor: '#00ff8844',
            data: [],
            fill: true,
            tension: 0.4,
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { labels: { color: 'white' } }
        },
        scales: {
          x: { ticks: { color: 'white' } },
          y: { ticks: { color: 'white' } }
        }
      }
    });

    function drawNoDataText() {
      const chart = adsChart;
      const ctx = chart.ctx;
      ctx.save();
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.font = '16px sans-serif';
      ctx.fillStyle = 'white';
      ctx.fillText('No Data', chart.width / 2, chart.height / 2);
      ctx.restore();
    }

    function updateChartWithFirebaseData() {
      const userId = firebase.auth().currentUser?.uid || 'anonymous';
      db.ref(`user/${userId}/adscampaign`).on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) {
          adsChart.data.labels = [];
          adsChart.data.datasets.forEach(ds => ds.data = []);
          adsChart.update();
          drawNoDataText();
          document.querySelector('.balance-btn').textContent = '$0.000';
          return;
        }

        const labels = [], views = [], clicks = [];
        Object.entries(data).forEach(([date, stats]) => {
          labels.push(date);
          views.push(stats.views || 0);
          clicks.push(stats.clicks || 0);
        });

        adsChart.data.labels = labels;
        adsChart.data.datasets[0].data = views;
        adsChart.data.datasets[1].data = clicks;
        adsChart.update();

        const totalClicks = clicks.reduce((a, b) => a + b, 0);
        const balance = totalClicks * 0.01;
        document.querySelector('.balance-btn').textContent = `$${balance.toFixed(3)}`;
      }, (error) => {
        adsChart.data.labels = [];
        adsChart.data.datasets.forEach(ds => ds.data = []);
        adsChart.update();
        drawNoDataText();
        document.querySelector('.balance-btn').textContent = '$0.000';
        console.error('Firebase error:', error);
      });
    }

    firebase.auth().onAuthStateChanged((user) => {
      if (user) updateChartWithFirebaseData();
    });

    function toggleMenu() {
      alert('Sidebar toggle coming soon!');
    }
  </script>
</body>
</html>