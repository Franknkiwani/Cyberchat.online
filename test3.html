<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Next-Level Social Media Dashboard</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #eee;
    overflow: hidden;
  }

  /* Layout */
  .app {
    display: flex;
    height: 100vh;
    width: 100vw;
  }

  /* Sidebar */
  .sidebar {
    width: 72px;
    background: rgba(15, 30, 45, 0.9);
    box-shadow: 2px 0 10px #00ffcc55;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 0;
    backdrop-filter: blur(8px);
    transition: width 0.3s ease;
    position: relative;
  }
  .sidebar:hover {
    width: 200px;
  }
  .sidebar:hover .icon-label {
    opacity: 1;
    pointer-events: auto;
  }

  /* Sidebar icons container */
  .nav-item {
    width: 100%;
    color: #00ffcc;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    user-select: none;
    transition: background 0.25s ease;
  }
  .nav-item:hover {
    background: #00ffcc22;
  }
  .nav-icon {
    width: 28px;
    height: 28px;
    fill: #00ffcc;
    flex-shrink: 0;
  }
  .icon-label {
    margin-left: 16px;
    opacity: 0;
    pointer-events: none;
    white-space: nowrap;
    transition: opacity 0.3s ease;
  }

  /* Main content area */
  .main-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    padding: 25px 40px;
    overflow-y: auto;
  }

  /* Header */
  header {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
  }
  .user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
  }
  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid #00ffcc;
    background: url('https://i.pravatar.cc/40') no-repeat center/cover;
  }
  .username {
    color: #00ffcc;
    font-weight: 700;
  }

  /* Cards */
  .card {
    background: rgba(15, 30, 45, 0.8);
    padding: 25px;
    border-radius: 18px;
    box-shadow: 0 0 30px #00ffcc55;
    margin-bottom: 40px;
    max-width: 900px;
    width: 100%;
  }
  .card h2 {
    margin: 0 0 18px 0;
    font-weight: 700;
    color: #00ffcc;
    font-size: 22px;
  }

  /* Monetization bars */
  .progress-group {
    margin-bottom: 20px;
  }
  .progress-label {
    font-weight: 600;
    margin-bottom: 6px;
    color: #a0fff3;
  }
  .progress-bar {
    width: 100%;
    height: 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: inset 0 2px 5px #0008;
  }
  .progress-fill {
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, #00ffcc, #006655);
    border-radius: 10px;
    box-shadow: 0 0 10px #00ffccbb;
    transition: width 0.8s ease;
  }
  .progress-text {
    font-family: monospace;
    font-size: 13px;
    margin-top: 6px;
    text-align: right;
    color: #a0fff3;
  }
  #monetize-status {
    margin-top: 10px;
    font-weight: 700;
    color: #00ffcc;
    font-family: 'Segoe UI', sans-serif;
  }

  /* Chart container */
  #chart-container {
    position: relative;
    height: 400px;
  }

  /* Scrollbar styling for main-content */
  .main-content::-webkit-scrollbar {
    width: 8px;
  }
  .main-content::-webkit-scrollbar-track {
    background: transparent;
  }
  .main-content::-webkit-scrollbar-thumb {
    background: #00ffcc88;
    border-radius: 10px;
  }
</style>
</head>
<body>

<div class="app">
  <nav class="sidebar">
    <div class="nav-item" title="Dashboard">
      <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8v-10h-8v10zm0-18v6h8V3h-8z"/></svg>
      <span class="icon-label">Dashboard</span>
    </div>
    <div class="nav-item" title="Posts">
      <svg class="nav-icon" viewBox="0 0 24 24"><path d="M5 4v3h5.5v12H19v-3h-5.5V4z"/></svg>
      <span class="icon-label">Posts</span>
    </div>
    <div class="nav-item" title="Monetization">
      <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 2L1 7l11 5 9-4.09V17h2V7L12 2z"/></svg>
      <span class="icon-label">Monetize</span>
    </div>
    <div class="nav-item" title="Settings">
      <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 8a4 4 0 100 8 4 4 0 000-8zm0-6v2.18a6.015 6.015 0 014.2 1.61l1.46-1.46 1.41 1.41-1.46 1.46A6.015 6.015 0 0120.82 12H23v2h-2.18a6.015 6.015 0 01-1.61 4.2l1.46 1.46-1.41 1.41-1.46-1.46A6.015 6.015 0 0112 20.82V23h-2v-2.18a6.015 6.015 0 01-4.2-1.61l-1.46 1.46-1.41-1.41 1.46-1.46A6.015 6.015 0 013.18 14H1v-2h2.18a6.015 6.015 0 011.61-4.2L2.33 6.33l1.41-1.41 1.46 1.46A6.015 6.015 0 0110 4.18V2h2z"/></svg>
      <span class="icon-label">Settings</span>
    </div>
  </nav>

  <main class="main-content">
    <header>
      <div class="user-info" title="Profile">
        <div class="user-avatar"></div>
        <div class="username" id="username">Loading...</div>
      </div>
    </header>

    <section class="card">
      <h2>Monetization Progress</h2>
      <div class="progress-group">
        <div class="progress-label">Followers</div>
        <div class="progress-bar">
          <div id="followers-progress" class="progress-fill"></div>
        </div>
        <div class="progress-text"><span id="followers-count">0</span>/100</div>
      </div>
      <div class="progress-group">
        <div class="progress-label">Views</div>
        <div class="progress-bar">
          <div id="views-progress" class="progress-fill"></div>
        </div>
        <div class="progress-text"><span id="views-count">0</span>/1000</div>
      </div>
      <div id="monetize-status">Loading monetization status...</div>
    </section>

    <section class="card" id="chart-container">
      <h2>Analytics Overview</h2>
      <canvas id="performanceChart"></canvas>
    </section>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // DOM Elements
  const followersProgress = document.getElementById('followers-progress');
  const viewsProgress = document.getElementById('views-progress');
  const followersCountEl = document.getElementById('followers-count');
  const viewsCountEl = document.getElementById('views-count');
  const monetizeStatus = document.getElementById('monetize-status');
  const usernameEl = document.getElementById('username');
  const monetizeBtn = document.getElementById('monetize-btn');
  const profilePicEl = document.getElementById('profile-pic');

  // Thresholds
  const FOLLOWERS_TARGET = 100;
  const VIEWS_TARGET = 1000;

  // Load user profile (username + profile pic) from Firebase DB or Auth
  async function loadUserProfile(uid) {
    // Try your /users/{uid} node for username & profile pic
    const userRef = ref(db, `users/${uid}`);
    try {
      const snapshot = await get(userRef);
      if (snapshot.exists()) {
        const userData = snapshot.val();
        usernameEl.textContent = userData.username || 'User';
        if (userData.profilePic) {
          profilePicEl.src = userData.profilePic;
        } else {
          profilePicEl.src = 'https://i.pravatar.cc/150?img=13'; // fallback avatar
        }
        return userData;
      }
    } catch(e) {
      console.error('Error loading user profile:', e);
    }

    // Fallback to Firebase Auth displayName if set
    const currentUser = auth.currentUser;
    if (currentUser) {
      usernameEl.textContent = currentUser.displayName || 'User';
      profilePicEl.src = currentUser.photoURL || 'https://i.pravatar.cc/150?img=13';
    }
  }

  // Load monetization stats from Firebase and update progress bars
  async function loadUserStats(uid) {
    const statsRef = ref(db, `users/${uid}/stats`);
    try {
      const snapshot = await get(statsRef);
      if (snapshot.exists()) {
        return snapshot.val();
      }
    } catch(e) {
      console.error('Error loading user stats:', e);
    }
    // fallback dummy if no data
    return { followers: 0, views: 0, monetizeStatus: 'not eligible' };
  }

  function updateProgressBars(stats) {
    const followersPercent = Math.min(stats.followers / FOLLOWERS_TARGET, 1) * 100;
    const viewsPercent = Math.min(stats.views / VIEWS_TARGET, 1) * 100;

    followersProgress.style.width = followersPercent + '%';
    viewsProgress.style.width = viewsPercent + '%';

    followersCountEl.textContent = stats.followers;
    viewsCountEl.textContent = stats.views;

    let statusText = '';
    const canMonetize = stats.followers >= FOLLOWERS_TARGET && stats.views >= VIEWS_TARGET;

    if (canMonetize) {
      statusText = 'You are eligible for monetization! Hit that button.';
      monetizeBtn.disabled = false;
      monetizeBtn.textContent = 'Monetize Now';
      monetizeBtn.classList.remove('disabled');
    } else {
      monetizeBtn.disabled = true;
      monetizeBtn.textContent = 'Monetize Now';
      monetizeBtn.classList.add('disabled');

      const followersPct = Math.floor((stats.followers / FOLLOWERS_TARGET) * 100);
      const viewsPct = Math.floor((stats.views / VIEWS_TARGET) * 100);

      statusText = `Keep going! Followers: ${followersPct}%, Views: ${viewsPct}% towards monetization.`;
    }

    monetizeStatus.textContent = statusText;
  }

  // Handle monetize button click
  monetizeBtn.addEventListener('click', () => {
    alert('Monetization process started! (Implement your flow here)');
    // Here youâ€™d call your backend or Firebase function to apply
  });

  // Initialize on auth state
  onAuthStateChanged(auth, async user => {
    if (user) {
      await loadUserProfile(user.uid);
      const stats = await loadUserStats(user.uid);
      updateProgressBars(stats);
      // You can call your graph update function here if needed
    } else {
      usernameEl.textContent = 'Guest';
      profilePicEl.src = 'https://i.pravatar.cc/150?img=13';
      followersCountEl.textContent = '0';
      viewsCountEl.textContent = '0';
      followersProgress.style.width = '0%';
      viewsProgress.style.width = '0%';
      monetizeStatus.textContent = 'Please log in to see your stats.';
      monetizeBtn.disabled = true;
      monetizeBtn.classList.add('disabled');
    }
  });
</script>

</body>
</html>