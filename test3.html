<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Social Media Dashboard</title>
<style>
  /* Reset & basics */
  body {
    margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #121212;
    color: #ddd;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* Header */
  header {
    height: 48px;
    background: #1f1f1f;
    display: flex;
    align-items: center;
    padding: 0 12px;
    font-weight: 600;
    font-size: 18px;
    user-select: none;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  #hamburger {
    cursor: pointer;
    margin-right: 12px;
    font-size: 24px;
  }

  /* Sidebar */
  #sidebar {
    position: fixed;
    top: 48px;
    left: -220px;
    width: 220px;
    height: calc(100vh - 48px);
    background: #222;
    padding: 1rem;
    box-sizing: border-box;
    transition: left 0.3s ease;
    color: #ccc;
    overflow-y: auto;
    font-size: 14px;
  }
  #sidebar.open {
    left: 0;
  }
  #sidebar a {
    display: block;
    color: #ccc;
    padding: 10px 0;
    text-decoration: none;
  }
  #sidebar a:hover {
    color: #4caf50;
  }

  /* Main content */
  main {
    margin-top: 12px;
    margin-left: 12px;
    padding: 0 12px 40px;
    max-width: 980px;
    width: 100%;
    margin-inline: auto;
  }

  /* User Info bar */
  .user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
  }
  .user-info img {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    background: #444;
  }
  .user-texts {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .username {
    font-size: 20px;
    font-weight: 700;
    color: #fff;
  }
  .handle {
    color: #999;
    font-size: 14px;
  }
  .followers {
    margin-left: auto;
    font-weight: 600;
    font-size: 16px;
    color: #ddd;
  }

  /* Stats Bars Container */
  .stats-container {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }

  /* Single stat card */
  .stat-card {
    flex: 1 1 48%;
    background: #1f1f1f;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 0 8px #111 inset;
    color: #ddd;
  }

  .stat-title {
    font-size: 14px;
    color: #aaa;
    margin-bottom: 8px;
  }
  .stat-value {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 4px;
    color: #eee;
  }
  .stat-change {
    font-size: 14px;
    font-weight: 600;
    color: #4caf50;
  }
  .stat-change.negative {
    color: #f44336;
  }

  /* Progress bar */
  .progress-container {
    margin-top: 12px;
    background: #333;
    border-radius: 8px;
    height: 12px;
    overflow: hidden;
  }
  .progress-bar {
    height: 100%;
    background: #4caf50;
    width: 0;
    transition: width 0.5s ease;
  }

  /* Monetization card specifics */
  #monetize-card {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  #monetize-status {
    font-weight: 700;
    font-size: 18px;
  }
  #monetize-now-btn {
    padding: 8px 16px;
    border: none;
    background: #4caf50;
    color: #121212;
    font-weight: 700;
    border-radius: 6px;
    cursor: pointer;
    max-width: 140px;
  }
  #monetize-now-btn:disabled {
    background: #666;
    cursor: not-allowed;
  }

  /* Earnings bar */
  #earnings-bar {
    margin-top: 8px;
    font-weight: 700;
    font-size: 22px;
    color: #4caf50;
  }
</style>
</head>
<body>

<header>
  <div id="hamburger">&#9776;</div>
  Social Media Dashboard
</header>

<nav id="sidebar">
  <a href="#">Home</a>
  <a href="#">Posts</a>
  <a href="#">Monetization</a>
  <a href="#">Settings</a>
  <a href="#" id="logout-btn">Logout</a>
</nav>

<main>
  <section class="user-info">
    <img src="https://via.placeholder.com/48" alt="Profile Picture" id="profile-pic" />
    <div class="user-texts">
      <div class="username" id="username">Username</div>
      <div class="handle" id="handle">@handle</div>
    </div>
    <div class="followers" id="followers-count">Followers (0)</div>
  </section>

  <section class="stats-container">
    <div class="stat-card" id="views-card">
      <div class="stat-title">Total Views</div>
      <div class="stat-value" id="views-count">0</div>
      <div class="stat-change" id="views-change">+0 today</div>
      <div class="progress-container">
        <div class="progress-bar" id="views-progress-bar"></div>
      </div>
    </div>

    <div class="stat-card" id="posts-card">
      <div class="stat-title">Total Posts</div>
      <div class="stat-value" id="total-posts">0</div>
      <div class="stat-change" id="posts-change">+0 today</div>
    </div>

    <div class="stat-card" id="earnings-card">
      <div class="stat-title">Total Earnings</div>
      <div class="stat-value" id="earnings">$0.00</div>
      <div class="stat-change" id="earnings-change">+ $0.00 today</div>
      <div id="earnings-bar"></div>
    </div>

    <div class="stat-card" id="monetize-card">
      <div class="stat-title">Monetization Status</div>
      <div id="monetize-status">Not Eligible</div>
      <button id="monetize-now-btn" disabled>Monetize Now</button>
      <div class="progress-container">
        <div class="progress-bar" id="followers-progress-bar"></div>
      </div>
      <div class="progress-container" style="margin-top:8px;">
        <div class="progress-bar" id="views-progress-bar-2"></div>
      </div>
      <div style="font-size:12px; color:#bbb; margin-top:4px;">
        Followers (100) | Views (1000) Required
      </div>
    </div>
  </section>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.firebasestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // UI Elements
  const monetizeStatusEl = document.getElementById("monetize-status");
  const monetizeBtnEl = document.getElementById("monetize-now-btn");
  const followersCountEl = document.getElementById("followers-count");
  const viewsCountEl = document.getElementById("views-count");
  const viewsChangeEl = document.getElementById("views-change");
  const postsCountEl = document.getElementById("total-posts");
  const postsChangeEl = document.getElementById("posts-change");
  const earningsEl = document.getElementById("earnings");
  const earningsChangeEl = document.getElementById("earnings-change");
  const profilePicEl = document.getElementById("profile-pic");
  const usernameEl = document.getElementById("username");
  const handleEl = document.getElementById("handle");

  const viewsProgressBar = document.getElementById("views-progress-bar");
  const followersProgressBar = document.getElementById("followers-progress-bar");
  const viewsProgressBar2 = document.getElementById("views-progress-bar-2");

  // Sidebar toggle
  const hamburger = document.getElementById("hamburger");
  const sidebar = document.getElementById("sidebar");
  hamburger.addEventListener("click", () => {
    sidebar.classList.toggle("open");
  });

  // Logout handler (dummy, you can customize)
  const logoutBtn = document.getElementById("logout-btn");
  logoutBtn.addEventListener("click", () => {
    signOut(auth).then(() => {
      alert("Logged out!");
      // redirect or whatever you want
    });
  });

  let currentUserUID = null;

  // Store previous stats to calculate deltas
  let prevViews = 0;
  let prevFollowers = 0;
  let prevPosts = 0;
  let prevEarnings = 0;

  const FOLLOWERS_REQ = 100;
  const VIEWS_REQ = 1000;

  onAuthStateChanged(auth, user => {
    if (user) {
      currentUserUID = user.uid;
      loadUserProfile(currentUserUID);
      loadDashboardData(currentUserUID);
    } else {
      // Reset UI if needed
      currentUserUID = null;
      // You could redirect to login here
    }
  });

  function loadUserProfile(uid) {
    const userRef = ref(db, `users/${uid}/profile`);
    onValue(userRef, (snap) => {
      const data = snap.val() || {};
      profilePicEl.src = data.photoURL || "https://via.placeholder.com/48";
      usernameEl.textContent = data.username || "Unknown User";
      handleEl.textContent = data.handle ? `@${data.handle}` : "@handle";
    });
  }

  function loadDashboardData(uid) {
    const followersRef = ref(db, `users/${uid}/followersCount`);
    const viewsRef = ref(db, `users/${uid}/viewsCount`);
    const postsRef = ref(db, `users/${uid}/totalPosts`);
    const earningsRef = ref(db, `users/${uid}/earnings`);
    const monetizeRef = ref(db, `users/${uid}/monetization`);

    // Followers
    onValue(followersRef, snap => {
      const val = snap.val() || 0;
      followersCountEl.textContent = `Followers (${val})`;
      updateFollowersProgress(val);
      updateFollowersChange(val);
      prevFollowers = val;
    });

    // Views
    onValue(viewsRef, snap => {
      const val = snap.val() || 0;
      viewsCountEl.textContent = val;
      updateViewsProgress(val);
      updateViewsChange(val);
      prevViews = val;
    });

    // Posts
    onValue(postsRef, snap => {
      const val = snap.val() || 0;
      postsCountEl.textContent = val;
      updatePostsChange(val);
      prevPosts = val;
    });

    // Earnings
    onValue(earningsRef, snap => {
      const val = snap.val() || 0;
      earningsEl.textContent = `$${val.toFixed(2)}`;
      updateEarningsChange(val);
      prevEarnings = val;
      updateEarningsBar(val);
    });

    // Monetization status
    onValue(monetizeRef, snap => {
      const status = snap.val() || "not_eligible";
      updateMonetizationUI(status);
    });
  }

  // Helpers for progress bars and changes

  function updateFollowersProgress(count) {
    const pct = Math.min(100, (count / FOLLOWERS_REQ) * 100);
    followersProgressBar.style.width = pct + "%";
  }
  function updateViewsProgress(count) {
    const pct = Math.min(100, (count / VIEWS_REQ) * 100);
    viewsProgressBar.style.width = pct + "%";
    viewsProgressBar2.style.width = pct + "%";
  }

  // Calculate deltas and show + or - with color
  function updateFollowersChange(current) {
    const diff = current - prevFollowers;
    // No UI element needed now but could add if wanted
  }
  function updateViewsChange(current) {
    const diff = current - prevViews;
    if (diff >= 0) {
      viewsChangeEl.textContent = `+${diff} today`;
      viewsChangeEl.classList.remove("negative");
    } else {
      viewsChangeEl.textContent = `${diff} today`;
      viewsChangeEl.classList.add("negative");
    }
  }
  function updatePostsChange(current) {
    const diff = current - prevPosts;
    if (diff >= 0) {
      postsChangeEl.textContent = `+${diff} today`;
      postsChangeEl.classList.remove("negative");
    } else {
      postsChangeEl.textContent = `${diff} today`;
      postsChangeEl.classList.add("negative");
    }
  }
  function updateEarningsChange(current) {
    const diff = current - prevEarnings;
    if (diff >= 0) {
      earningsChangeEl.textContent = `+ $${diff.toFixed(2)} today`;
      earningsChangeEl.classList.remove("negative");
    } else {
      earningsChangeEl.textContent = `- $${Math.abs(diff).toFixed(2)} today`;
      earningsChangeEl.classList.add("negative");
    }
  }

  // Earnings bar grows with earnings, max at $100 for visual
  function updateEarningsBar(earnings) {
    const max = 100;
    const pct = Math.min(100, (earnings / max) * 100);
    document.getElementById("earnings-bar").style.width = pct + "%";
  }

  // Monetization UI updates
  function updateMonetizationUI(status) {
    if (status === "eligible") {
      monetizeStatusEl.textContent = "Eligible to Monetize";
      monetizeStatusEl.style.color = "#4caf50";
      monetizeBtnEl.disabled = false;
    } else if (status === "pending") {
      monetizeStatusEl.textContent = "Monetization Pending Approval";
      monetizeStatusEl.style.color = "#ff9800";
      monetizeBtnEl.disabled = true;
    } else if (status === "active") {
      monetizeStatusEl.textContent = "Monetization Active";
      monetizeStatusEl.style.color = "#4caf50";
      monetizeBtnEl.disabled = true;
    } else {
      monetizeStatusEl.textContent = "Not Eligible";
      monetizeStatusEl.style.color = "#f44336";
      monetizeBtnEl.disabled = true;
    }
  }

  // Monetize button click handler
  monetizeBtnEl.addEventListener("click", () => {
    if (!currentUserUID) return alert("You must be logged in.");
    // Set monetization status to pending in Firebase
    const monetizeStatusRef = ref(db, `users/${currentUserUID}/monetization`);
    monetizeStatusRef.set("pending").then(() => {
      alert("Monetization request submitted! Await approval.");
      monetizeBtnEl.disabled = true;
      monetizeStatusEl.textContent = "Monetization Pending Approval";
      monetizeStatusEl.style.color = "#ff9800";
    }).catch(err => {
      alert("Error submitting monetization request: " + err.message);
    });
  });

</script>

</body>
</html>