<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Social Media Creator Dashboard</title>
<style>
  /* Basic reset + fonts */
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #0f111a;
    color: #e0e0e0;
  }
  .container {
    max-width: 1100px;
    margin: 20px auto;
    padding: 15px;
  }
  header {
    display: flex;
    align-items: center;
    gap: 15px;
    border-bottom: 1px solid #222833;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }
  #profile-pic {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #08f;
  }
  #username {
    font-weight: 700;
    font-size: 1.4rem;
    color: #08f;
  }
  h2 {
    font-weight: 600;
    margin-top: 0;
    color: #08f;
  }

  /* Progress Bars Container */
  .progress-container {
    margin-bottom: 25px;
  }
  .progress-label {
    font-weight: 600;
    margin-bottom: 6px;
  }
  .progress-bar {
    background: #222833;
    border-radius: 12px;
    overflow: hidden;
    height: 20px;
    width: 100%;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #0f8, #08f);
    width: 0;
    transition: width 1.2s ease;
  }
  .progress-numbers {
    margin-top: 4px;
    font-size: 0.9rem;
    color: #aaa;
  }

  /* Monetize Button & Status */
  #monetize-btn {
    background: #08f;
    border: none;
    padding: 12px 28px;
    font-size: 1rem;
    font-weight: 700;
    border-radius: 30px;
    color: white;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #monetize-btn.disabled {
    background: #444a57;
    cursor: not-allowed;
  }
  #monetize-status {
    margin-top: 12px;
    font-size: 1rem;
    font-weight: 600;
    color: #aaa;
  }

  /* Chart Container */
  #chart-container {
    background: #121722;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 0 10px #08f44d44;
  }
  canvas {
    width: 100% !important;
    max-height: 350px;
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <img id="profile-pic" src="https://i.pravatar.cc/150?img=13" alt="Profile Pic" />
    <div id="username">Loading...</div>
  </header>

  <section class="progress-container">
    <h2>Monetization Progress</h2>

    <div>
      <div class="progress-label">Followers <span id="followers-count">0</span> / 100</div>
      <div class="progress-bar">
        <div id="followers-progress" class="progress-fill"></div>
      </div>
    </div>

    <div style="margin-top: 15px;">
      <div class="progress-label">Views <span id="views-count">0</span> / 1000</div>
      <div class="progress-bar">
        <div id="views-progress" class="progress-fill"></div>
      </div>
    </div>

    <button id="monetize-btn" class="disabled" disabled>Monetize Now</button>
    <div id="monetize-status">Loading progress...</div>
  </section>

  <section id="chart-container">
    <h2>Views & Earnings Over Time</h2>
    <canvas id="monetization-chart"></canvas>
  </section>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
  import Chart from "https://cdn.jsdelivr.net/npm/chart.js";

  // FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // DOM refs
  const followersProgress = document.getElementById('followers-progress');
  const viewsProgress = document.getElementById('views-progress');
  const followersCountEl = document.getElementById('followers-count');
  const viewsCountEl = document.getElementById('views-count');
  const monetizeStatus = document.getElementById('monetize-status');
  const usernameEl = document.getElementById('username');
  const monetizeBtn = document.getElementById('monetize-btn');
  const profilePicEl = document.getElementById('profile-pic');
  const ctx = document.getElementById('monetization-chart').getContext('2d');

  // Constants for eligibility
  const FOLLOWERS_TARGET = 100;
  const VIEWS_TARGET = 1000;

  // Chart instance placeholder
  let monetizationChart;

  // Joke before loading data:
  console.log("Why don't programmers like nature? Too many bugs.");

  // Load user profile info from Firebase DB or fallback to Auth
  async function loadUserProfile(uid) {
    const userRef = ref(db, `users/${uid}`);
    try {
      const snapshot = await get(userRef);
      if (snapshot.exists()) {
        const userData = snapshot.val();
        usernameEl.textContent = userData.username || 'User';
        profilePicEl.src = userData.profilePic || 'https://i.pravatar.cc/150?img=13';
        return userData;
      }
    } catch (e) {
      console.error("Error loading user profile:", e);
    }
    const currentUser = auth.currentUser;
    if (currentUser) {
      usernameEl.textContent = currentUser.displayName || 'User';
      profilePicEl.src = currentUser.photoURL || 'https://i.pravatar.cc/150?img=13';
    }
  }

  // Load monetization stats (followers, views) from Firebase DB
  async function loadUserStats(uid) {
    const statsRef = ref(db, `users/${uid}/stats`);
    try {
      const snapshot = await get(statsRef);
      if (snapshot.exists()) {
        return snapshot.val();
      }
    } catch (e) {
      console.error("Error loading user stats:", e);
    }
    // fallback dummy if no stats
    return { followers: 0, views: 0 };
  }

  // Load chart data from Firebase or mock sample
  async function loadChartData(uid) {
    const chartRef = ref(db, `users/${uid}/monetizationHistory`);
    try {
      const snapshot = await get(chartRef);
      if (snapshot.exists()) {
        return snapshot.val();
      }
    } catch (e) {
      console.error("Error loading chart data:", e);
    }
    // fallback dummy data if none found
    return {
      dates: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
      views: [120, 300, 450, 400, 600, 700, 850],
      earnings: [0, 1.5, 2.3, 2.1, 3.0, 3.5, 4.0]
    };
  }

  // Update progress bars and button based on real data
  function updateProgressBars(stats) {
    const followersPercent = Math.min(stats.followers / FOLLOWERS_TARGET, 1) * 100;
    const viewsPercent = Math.min(stats.views / VIEWS_TARGET, 1) * 100;

    followersProgress.style.width = followersPercent + '%';
    viewsProgress.style.width = viewsPercent + '%';

    followersCountEl.textContent = stats.followers;
    viewsCountEl.textContent = stats.views;

    const canMonetize = stats.followers >= FOLLOWERS_TARGET && stats.views >= VIEWS_TARGET;
    if (canMonetize) {
      monetizeStatus.textContent = "You are eligible for monetization! Hit that button.";
      monetizeBtn.disabled = false;
      monetizeBtn.classList.remove('disabled');
      monetizeBtn.textContent = "Monetize Now";
    } else {
      monetizeBtn.disabled = true;
      monetizeBtn.classList.add('disabled');
      monetizeBtn.textContent = "Monetize Now";

      const followersPct = Math.floor((stats.followers / FOLLOWERS_TARGET) * 100);
      const viewsPct = Math.floor((stats.views / VIEWS_TARGET) * 100);

      monetizeStatus.textContent = `Keep grinding! Followers: ${followersPct}%, Views: ${viewsPct}% towards monetization.`;
    }
  }

  // Initialize Chart.js graph
  function renderChart(chartData) {
    const labels = chartData.dates || [];
    const viewsData = chartData.views || [];
    const earningsData = chartData.earnings || [];

    if (monetizationChart) monetizationChart.destroy();

    monetizationChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: 'Views',
            data: viewsData,
            borderColor: '#08f',
            backgroundColor: 'rgba(0, 122, 255, 0.3)',
            fill: true,
            yAxisID: 'y',
            tension: 0.3,
            pointRadius: 3,
          },
          {
            label: 'Earnings ($)',
            data: earningsData,
            borderColor: '#0f8',
            backgroundColor: 'rgba(0, 255, 136, 0.3)',
            fill: true,
            yAxisID: 'y1',
            tension: 0.3,
            pointRadius: 3,
          }
        ]
      },
      options: {
        responsive: true,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        stacked: false,
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            ticks: {
              color: '#08f',
            },
            title: {
              display: true,
              text: 'Views',
              color: '#08f',
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            grid: {
              drawOnChartArea: false,
            },
            ticks: {
              color: '#0f8',
            },
            title: {
              display: true,
              text: 'Earnings ($)',
              color: '#0f8',
            }
          },
          x: {
            ticks: {
              color: '#eee',
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: '#eee',
              font: { weight: 'bold' }
            }
          },
          tooltip: {
            mode: 'index',
            intersect: false,
          }
        }
      }
    });
  }

  monetizeBtn.addEventListener('click', () => {
    alert('Monetization started! Implement your logic here.');
  });

  // Start listening to auth and fetch data
  onAuthStateChanged(auth, async user => {
    if (user) {
      await loadUserProfile(user.uid);
      const stats = await loadUserStats(user.uid);
      updateProgressBars(stats);
      const chartData = await loadChartData(user.uid);
      renderChart(chartData);
    } else {
      usernameEl.textContent = 'Guest';
      profilePicEl.src = 'https://i.pravatar.cc/150?img=13';
      followersCountEl.textContent = '0';
      viewsCountEl.textContent = '0';
      followersProgress.style.width = '0%';
      viewsProgress.style.width = '0%';
      monetizeStatus.textContent = 'Please log in to see your stats.';
      monetizeBtn.disabled = true;
      monetizeBtn.classList.add('disabled');
      if (monetizationChart) monetizationChart.destroy();
    }
  });
</script>

</body>
</html>