<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberChat Dashboard</title>
  <style>
    :root {
      --bg-dark: #121212;
      --bg-card: #1e1e1e;
      --green: #4caf50;
      --red: #f44336;
      --cyan: #00ffff;
      --pink: #ff2c8e;
      --text-light: #eee;
      --border-green: #3a7d44;
      --border-red: #7d3a44;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg-dark);
      color: var(--text-light);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    header {
      position: sticky;
      top: 0;
      background: var(--bg-card);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 1rem;
      border-radius: 0 0 15px 15px;
      z-index: 1000;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.7);
    }

    .left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .hamburger {
      width: 28px;
      height: 22px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .hamburger span {
      display: block;
      height: 3.5px;
      background: var(--text-light);
      border-radius: 2px;
      transition: 0.3s;
    }

    .logo {
      font-weight: 900;
      font-size: 1.7rem;
      user-select: none;
      line-height: 1;
    }

    .logo .cyber {
      color: var(--pink);
    }

    .logo .chat {
      color: var(--cyan);
    }

    .profile-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid var(--text-light);
      flex-shrink: 0;
      background: var(--bg-dark);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .profile-btn img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .profile-btn svg {
      width: 22px;
      height: 22px;
      fill: var(--text-light);
    }

    main {
      padding: 1.5rem 1rem 3rem;
      max-width: 720px;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    @media (max-width: 640px) {
      main {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .stat-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.3rem 1.6rem;
      box-shadow:
        inset 0 0 0 2px var(--border-green),
        0 4px 12px rgb(0 0 0 / 0.8);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      position: relative;
    }

    .stat-card.red-border {
      box-shadow:
        inset 0 0 0 2px var(--border-red),
        0 4px 12px rgb(0 0 0 / 0.8);
    }

    .stat-title {
      font-weight: 600;
      font-size: 1.1rem;
      letter-spacing: 0.05em;
      color: var(--text-light);
    }

    .stat-value {
      font-weight: 800;
      font-size: 2.2rem;
      letter-spacing: 0.02em;
      line-height: 1.1;
      color: var(--text-light);
    }

    .stat-change {
      font-weight: 700;
      font-size: 1rem;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .stat-change.positive {
      color: var(--green);
    }

    .stat-change.negative {
      color: var(--red);
    }

    .stat-change::before {
      content: '+';
      font-weight: 900;
    }

    .stat-change.negative::before {
      content: '-';
    }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <button aria-label="Open menu" class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="logo"><span class="cyber">Cyber</span><span class="chat">Chat</span></div>
    </div>
    <button aria-label="User profile" class="profile-btn" id="profileBtn">
      <!-- Profile img or fallback icon inserted here -->
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M12 12c2.7 0 4.9-2.2 4.9-4.9S14.7 2.2 12 2.2 7.1 4.4 7.1 7.1 9.3 12 12 12zm0 2.4c-3.2 0-9.5 1.6-9.5 4.8v2.4h19v-2.4c0-3.2-6.3-4.8-9.5-4.8z"/>
      </svg>
    </button>
  </header>
  <main id="statsContainer">
    <!-- Stats cards get dynamically inserted here -->
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
      authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
      databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
      projectId: "itzhoyoo-f9f7e",
      storageBucket: "itzhoyoo-f9f7e.firebasestorage.app",
      messagingSenderId: "1094792075584",
      appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
      measurementId: "G-LLT6F9WRKH"
    };

    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const statsContainer = document.getElementById("statsContainer");
    const profileBtn = document.getElementById("profileBtn");

    // Update profile photo or fallback icon
    function updateProfilePhoto(user) {
      profileBtn.innerHTML = "";
      if (user.photoURL) {
        const img = document.createElement("img");
        img.src = user.photoURL;
        img.alt = user.displayName ? `${user.displayName} profile photo` : "User profile photo";
        profileBtn.appendChild(img);
      } else {
        profileBtn.innerHTML = `
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M12 12c2.7 0 4.9-2.2 4.9-4.9S14.7 2.2 12 2.2 7.1 4.4 7.1 7.1 9.3 12 12 12zm0 2.4c-3.2 0-9.5 1.6-9.5 4.8v2.4h19v-2.4c0-3.2-6.3-4.8-9.5-4.8z"/>
          </svg>
        `;
      }
    }

    // Create a single stat card element with value and last 24h change
    function createStatCard(title, value, change) {
      const card = document.createElement("div");
      card.classList.add("stat-card");

      // Red border if negative change, green if positive or zero
      if (change < 0) card.classList.add("red-border");

      const titleEl = document.createElement("div");
      titleEl.className = "stat-title";
      titleEl.textContent = title;

      const valueEl = document.createElement("div");
      valueEl.className = "stat-value";
      valueEl.textContent = value;

      const changeEl = document.createElement("div");
      changeEl.className = "stat-change";
      changeEl.textContent = Math.abs(change);
      changeEl.classList.add(change >= 0 ? "positive" : "negative");

      card.appendChild(titleEl);
      card.appendChild(valueEl);
      card.appendChild(changeEl);

      return card;
    }

    async function fetchUserStats(uid) {
      const userRef = ref(db, `users/${uid}`);
      const snapshot = await get(userRef);
      if (!snapshot.exists()) return null;
      return snapshot.val();
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        updateProfilePhoto(user);

        const stats = await fetchUserStats(user.uid);
        statsContainer.innerHTML = "";

        if (!stats) {
          statsContainer.textContent = "No stats found for this user.";
          return;
        }

        // Build cards
        const cards = [
          createStatCard("Followers", stats.followers ?? 0, stats.followersChange ?? 0),
          createStatCard("Earnings", `$${(stats.earnings ?? 0).toFixed(2)}`, stats.earningsChange ?? 0),
          createStatCard("Posts", stats.posts ?? 0, stats.postsChange ?? 0),
          createStatCard("Views", stats.views ?? 0, stats.viewsChange ?? 0)
        ];

        cards.forEach(card => statsContainer.appendChild(card));
      } else {
        profileBtn.innerHTML = `
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M12 12c2.7 0 4.9-2.2 4.9-4.9S14.7 2.2 12 2.2 7.1 4.4 7.1 7.1 9.3 12 12 12zm0 2.4c-3.2 0-9.5 1.6-9.5 4.8v2.4h19v-2.4c0-3.2-6.3-4.8-9.5-4.8z"/>
          </svg>
        `;
        statsContainer.innerHTML = "<p style='grid-column: 1/-1; text-align:center;'>Please log in to view stats.</p>";
      }
    });
  </script>
</body>
</html>