<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Social Media Creator Dashboard</title>
<style>
  /* Reset + base */
  * {
    box-sizing: border-box;
  }
  body {
    margin:0; padding:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
      Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    background: #121212;
    color: #eee;
  }
  a {
    color: #4caf50;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
  /* Layout */
  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 50px;
    background: #1f1f1f;
    display: flex;
    align-items: center;
    padding: 0 1rem;
    z-index: 1000;
  }
  #hamburger {
    font-size: 1.5rem;
    cursor: pointer;
    user-select: none;
    margin-right: 1rem;
    color: #4caf50;
  }
  #sidebar {
    position: fixed;
    top: 50px; left: 0;
    width: 220px;
    height: calc(100vh - 50px);
    background: #222;
    padding: 1rem;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    overflow-y: auto;
    z-index: 999;
  }
  #sidebar.open {
    transform: translateX(0);
  }
  #sidebar nav a {
    display: block;
    margin-bottom: 1rem;
    color: #eee;
    font-weight: 600;
  }
  main {
    margin-top: 50px;
    padding: 1rem;
    max-width: 720px;
    margin-left: auto;
    margin-right: auto;
  }
  .profile-overview {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .profile-overview img {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #4caf50;
  }
  .profile-info {
    flex-grow: 1;
  }
  .profile-info h2 {
    margin: 0;
    font-size: 1.25rem;
  }
  .profile-info p {
    margin: 0;
    opacity: 0.7;
  }
  .stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .stat-box {
    background: #1f1f1f;
    padding: 1rem;
    border-radius: 10px;
    position: relative;
  }
  .stat-title {
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    color: #aaa;
  }
  .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
  }
  .stat-change {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 0.8rem;
    font-weight: 600;
  }
  .positive {
    color: #4caf50;
  }
  .negative {
    color: #f44336;
  }
  .progress-bar-container {
    background: #333;
    height: 12px;
    border-radius: 6px;
    overflow: hidden;
    margin-top: 0.5rem;
  }
  .progress-bar {
    background: #4caf50;
    height: 100%;
    width: 0%;
    transition: width 0.5s ease;
  }
  .monetization-box {
    background: #272727;
    padding: 1rem;
    border-radius: 10px;
    margin-top: 1rem;
    text-align: center;
  }
  .monetization-status {
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  button#monetize-btn {
    background: #4caf50;
    border: none;
    color: white;
    padding: 0.75rem 1.5rem;
    font-weight: 700;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button#monetize-btn:disabled {
    background: #555;
    cursor: not-allowed;
  }
  /* Responsive */
  @media (max-width: 600px) {
    main {
      padding: 1rem 0.5rem;
      max-width: 100%;
    }
    .stats-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<header>
  <div id="hamburger">&#9776;</div>
  <h1 style="font-weight:700; font-size:1.2rem; color:#4caf50; margin:0;">Creator Dashboard</h1>
</header>

<aside id="sidebar">
  <nav>
    <a href="#">Dashboard</a>
    <a href="#">Monetize</a>
    <a href="#">Posts</a>
    <a href="#">Profile</a>
    <a href="#" id="logout-btn">Logout</a>
  </nav>
</aside>

<main>
  <section class="profile-overview">
    <img id="user-photo" src="https://via.placeholder.com/64" alt="User Photo" />
    <div class="profile-info">
      <h2 id="username">Loading...</h2>
      <p id="userhandle">@loading</p>
      <p><strong>Followers:</strong> <span id="followers-count">0</span></p>
    </div>
  </section>

  <section class="stats-grid">
    <div class="stat-box">
      <div class="stat-title">Total Views</div>
      <div class="stat-value" id="total-views">0</div>
      <div class="stat-change positive" id="views-change">+0 today</div>
      <div class="progress-bar-container">
        <div id="views-progress" class="progress-bar"></div>
      </div>
    </div>
    <div class="stat-box">
      <div class="stat-title">Total Earnings</div>
      <div class="stat-value" id="total-earnings">$0.00</div>
      <div class="stat-change positive" id="earnings-change">+ $0.00 today</div>
      <div class="progress-bar-container">
        <div id="earnings-progress" class="progress-bar"></div>
      </div>
    </div>
    <div class="stat-box">
      <div class="stat-title">Total Posts</div>
      <div class="stat-value" id="total-posts">0</div>
      <div class="stat-change positive" id="posts-change">+0 today</div>
    </div>
    <div class="stat-box monetization-box">
      <div class="stat-title">Monetization Status</div>
      <div class="monetization-status" id="monetize-status">Checking...</div>
      <button id="monetize-btn" disabled>Monetize Now</button>
    </div>
  </section>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    onValue,
    get,
    child,
    query,
    orderByChild,
    limitToLast
  } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.firebasestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // UI elements
  const hamburger = document.getElementById("hamburger");
  const sidebar = document.getElementById("sidebar");
  const logoutBtn = document.getElementById("logout-btn");

  const userPhoto = document.getElementById("user-photo");
  const usernameEl = document.getElementById("username");
  const userhandleEl = document.getElementById("userhandle");
  const followersCountEl = document.getElementById("followers-count");

  const totalViewsEl = document.getElementById("total-views");
  const earningsChangeEl = document.getElementById("earnings-change");
  const viewsChangeEl = document.getElementById("views-change");
  const postsChangeEl = document.getElementById("posts-change");
  const monetizeStatusEl = document.getElementById("monetize-status");
  const monetizeBtn = document.getElementById("monetize-btn");
  const viewsProgressEl = document.getElementById("views-progress");
  const earningsProgressEl = document.getElementById("earnings-progress");

  // Check if user is logged in
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // User is logged in
      fetchUserData(user.uid);
    } else {
      // User is not logged in, redirect to login page
      window.location.href = 'login.html';
    }
  });

  function fetchUserData(uid) {
    const userRef = ref(db, 'users/' + uid);
    const postsRef = ref(db, 'posts/');
    const followersRef = ref(db, 'followers/' + uid);

    onValue(userRef, (snapshot) => {
      const userData = snapshot.val();
      updateUserInfo(userData);
    });

    // Get user's total posts
    onValue(postsRef, (snapshot) => {
      const posts = snapshot.val() || {};
      const userPosts = Object.values(posts).filter(post => post.userId === uid);
      const totalPosts = userPosts.length;
      updatePostsStats(totalPosts);
    });

    // Get user's total followers and views
    onValue(followersRef, (snapshot) => {
      const followers = snapshot.val() || {};
      const totalFollowers = Object.keys(followers).length;
      updateFollowersStats(totalFollowers);
    });
  }

  function updateUserInfo(data) {
    usernameEl.innerText = data.username || 'No username';
    userhandleEl.innerText = `@${data.handle}`;
    userPhoto.src = data.photoURL || 'https://via.placeholder.com/64';
    monetizeStatusEl.innerText = data.monitizeStatus === 'on' ? 'Eligible' : 'Not Eligible';

    // Update monetization button
    if (data.monitizeStatus === 'on') {
      monetizeBtn.disabled = true;
      monetizeBtn.innerText = 'Already Monetized';
    } else {
      monetizeBtn.disabled = false;
      monetizeBtn.innerText = 'Monetize Now';
    }

    // Update stats from data
    updateFollowersStats(data.followers || 0);
    updateViewsStats(data.views || 0);
    updateEarningsStats(data.earnings || 0);
  }

  function updateFollowersStats(totalFollowers) {
    followersCountEl.innerText = totalFollowers;
    updateProgressBar(totalFollowers, 100, followersProgressEl);
  }

  function updateViewsStats(totalViews) {
    totalViewsEl.innerText = totalViews;
    updateProgressBar(totalViews, 1000, viewsProgressEl);
  }

  function updateEarningsStats(totalEarnings) {
    const earningsFormatted = `$${totalEarnings.toFixed(2)}`;
    totalEarningsEl.innerText = earningsFormatted;
    updateProgressBar(totalEarnings, 100, earningsProgressEl);
  }

  function updateProgressBar(current, goal, progressBarEl) {
    const progressPercentage = Math.min((current / goal) * 100, 100);
    progressBarEl.style.width = progressPercentage + '%';
  }

  // Real-time change in earnings, views, and posts
  function updateStatsChange(statsType, currentStat, previousStat) {
    const delta = currentStat - previousStat;
    let sign = '';
    let color = '';

    if (delta > 0) {
      sign = `+${delta}`;
      color = 'positive';
    } else if (delta < 0) {
      sign = `${delta}`;
      color = 'negative';
    } else {
      sign = '+0';
      color = 'positive';
    }

    if (statsType === 'views') {
      viewsChangeEl.innerText = `${sign} today`;
      viewsChangeEl.classList.add(color);
    } else if (statsType === 'earnings') {
      earningsChangeEl.innerText = `${sign} today`;
      earningsChangeEl.classList.add(color);
    } else if (statsType === 'posts') {
      postsChangeEl.innerText = `${sign} today`;
      postsChangeEl.classList.add(color);
    }
  }

  // Sidebar toggle
  hamburger.addEventListener('click', () => {
    sidebar.classList.toggle('open');
  });

  // Logout functionality
  logoutBtn.addEventListener('click', () => {
    signOut(auth).then(() => {
      window.location.href = 'login.html';
    }).catch((error) => {
      console.error("Logout error:", error);
    });
  });

  // Handle Monetize Now button
  monetizeBtn.addEventListener('click', () => {
    if (monetizeBtn.disabled) return;

    // Redirect to monetize page
    window.location.href = 'monetize.html';
  });
</script>

</body>
</html>