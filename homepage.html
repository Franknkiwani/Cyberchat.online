<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Make Money - Dark Theme</title>
<style>
* {
  box-sizing: border-box;
  user-select: none;
  -webkit-user-select: none; /* Safari */
  -moz-user-select: none;    /* Firefox */
  -ms-user-select: none;     /* IE10+ */
  -webkit-tap-highlight-color: transparent;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
    Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background: #121212;
  color: #eee;
  display: flex;
  justify-content: center;
  padding: 0 20px;
}

.header-wrapper {
  width: 100%;
  max-width: 460px;
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  background: #181818;
  padding: 10px 0 12px;
  z-index: 9999;
  border-bottom: 1px solid #2a2a2a;
}

header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 28px;
  background: #222;
  border-radius: 40px;
  border: 1px solid #333;
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 16px;
}

.logo {
  width: 42px;
  height: 42px;
  background: linear-gradient(135deg, #4ade80, #22c55e);
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 700;
  font-size: 26px;
  color: white;
}

.site-name {
  font-weight: 700;
  font-size: 18px;
  color: #eee;
}

.balance-btn {
  background: #22c55e;
  color: white;
  font-weight: 600;
  font-size: 16px;
  padding: 10px 30px;
  border-radius: 9999px;
  border: 2px solid black;
  cursor: pointer;
  transition: background 0.25s ease;
  outline: none;
}

.balance-btn:focus {
  outline: none;
}

.main {
  margin-top: 90px;
  max-width: 460px;
  width: 100%;
}

.sections {
  display: flex;
  justify-content: space-between;
  padding: 0 12px;
  margin-bottom: 16px;
  border-bottom: 1px solid #333;
  flex-direction: row;
}

.section {
  position: relative;
  width: 48%;
  background: transparent;
  padding: 14px 0;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 15px;
  font-weight: 600;
  color: #aaa;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  transition: color 0.3s ease, border-color 0.3s ease;
  justify-content: center;
  outline: none;
}

.section:hover {
  color: #22c55e;
}

.section.active,
.section:focus {
  color: #22c55e;
  border-bottom-color: #22c55e;
  font-weight: 700;
  outline: none !important;
}

.section:focus {
  outline: none !important;
}

.section-icon {
  width: 26px;
  height: 26px;
  flex-shrink: 0;
  stroke-width: 2.2;
}

.section-icon svg {
  width: 100%;
  height: 100%;
  stroke: currentColor;
  fill: none;
  stroke-linejoin: round;
  stroke-linecap: round;
}

.make-money-icon svg {
  fill: currentColor;
  stroke: none;
}

main {
  padding: 0 12px;
  color: #ccc;
  min-height: 160px;
}

main h1 {
  color: #eee;
}

main p {
  /* user-select is disabled globally, so no override here */
}

@media (max-width: 480px) {
  .sections {
    flex-direction: row;
    gap: 12px;
    padding: 0 8px;
  }
  .section {
    width: 48%;
    justify-content: center;
    padding-left: 0;
  }
  header {
    padding: 14px 20px;
  }
  .header-wrapper {
    padding: 8px 0 10px;
  }
}

#cashout-form input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  background: #1f1f1f;
  border: 1px solid #333;
  color: #eee;
  font-size: 14px;
  margin-bottom: 8px;
}

#cashout-form label {
  font-weight: 600;
  display: block;
  margin-bottom: 6px;
  color: #ccc;
}

#cashout-form small {
  color: #888;
  font-size: 13px;
}

.required {
  color: #f87171;
}

.submit-btn {
  margin-top: 12px;
  padding: 12px;
  background: #22c55e;
  border: none;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  font-size: 16px;
  width: 100%;
  cursor: pointer;
  transition: background 0.2s ease;
}

.submit-btn:hover {
  background: #16a34a;
}
    #loader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #0b0f10;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 1s ease;
    }

    .grid-loader {
      display: grid;
      grid-template-columns: repeat(3, 24px);
      grid-gap: 10px;
    }

    .block {
      width: 24px;
      height: 24px;
      background-color: #1f2a2e;
      border-radius: 4px;
      animation: cashPulse 1.3s infinite ease-in-out;
    }

    .block:nth-child(1) { animation-delay: 0s; }
    .block:nth-child(2) { animation-delay: 0.1s; }
    .block:nth-child(3) { animation-delay: 0.2s; }
    .block:nth-child(4) { animation-delay: 0.3s; }
    .block:nth-child(5) { animation-delay: 0.4s; background-color: #00ff9c; }
    .block:nth-child(6) { animation-delay: 0.5s; }
    .block:nth-child(7) { animation-delay: 0.6s; }
    .block:nth-child(8) { animation-delay: 0.7s; }
    .block:nth-child(9) { animation-delay: 0.8s; }

    @keyframes cashPulse {
      0%, 100% {
        transform: scale(1);
        background-color: #1f2a2e;
      }
      50% {
        transform: scale(1.4);
        background-color: #00ff9c;
        box-shadow: 0 0 8px #00ff9c88;
      }
    }

    .icon {
      margin-top: 30px;
      width: 32px;
      height: 32px;
      background-image: url('https://img.icons8.com/fluency/48/money.png');
      background-size: contain;
      background-repeat: no-repeat;
      animation: iconJump 1.5s infinite ease-in-out;
    }

    .text {
      margin-top: 10px;
      color: #cddc39;
      letter-spacing: 1.5px;
      font-size: 1.05rem;
      text-align: center;
      animation: fadeText 2s ease-in-out infinite alternate;
    }

    @keyframes fadeText {
      from { opacity: 0.4; transform: translateY(2px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes iconJump {
      0%, 100% { transform: translateY(0); }
      50%      { transform: translateY(-8px); }
    }

    .fade-out {
      opacity: 0 !important;
      pointer-events: none;
    }
    button.active {
  background-color: #2563eb;  /* highlight color */
  color: white;
  /* other styling for active tab */
}

.modal {
  display: none; 
  position: fixed;
  z-index: 10000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
}
/* Backdrop covers entire screen with subtle blur */
#customAlertBackdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(4px);
  display: none; /* hidden by default */
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

/* The popup modal */
#customAlert {
  background: #fff;
  color: #222;
  padding: 24px 28px;
  border-radius: 16px;
  box-shadow:
    0 10px 15px rgba(0, 0, 0, 0.1),
    0 4px 6px rgba(0, 0, 0, 0.1);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  font-size: 17px;
  max-width: 320px;
  width: 90%;
  text-align: center;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  user-select: none;
}

/* Show the modal with fade + slide up */
#customAlert.show {
  opacity: 1;
  transform: translateY(0);
}

/* Success color accent */
#customAlert.success {
  border-left: 5px solid #34c759; /* iOS green accent */
}

/* Error color accent */
#customAlert.error {
  border-left: 5px solid #ff3b30; /* iOS red accent */
}

/* Optional close button */
#customAlert button.close-btn {
  margin-top: 18px;
  background: none;
  border: none;
  color: #888;
  font-size: 16px;
  cursor: pointer;
  user-select: none;
  transition: color 0.2s ease;
}

#customAlert button.close-btn:hover {
  color: #444;
}
.footer {
  position: sticky;
  bottom: 0;
  width: 100%;
  background-color: #000000; /* Black background */
  color: white;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.4);
  z-index: 50;
}

.footer-nav {
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 0.75rem 0;
}

.footer-link {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 0.875rem;
  text-decoration: none;
  color: inherit;
  transition: color 0.2s ease;
}

.footer-link:hover {
  color: #60a5fa; /* Tailwind blue-400 */
}

.footer-icon {
  width: 24px;
  height: 24px;
  margin-bottom: 4px;
}
/* Make the whole page take full viewport height */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
}

/* Make main content area grow to fill available space */
.main, main {
  flex: 1 0 auto;
}

/* Footer stays at bottom */
.footer {
  flex-shrink: 0;
}
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  width: 100%;
}

.main, main {
  flex: 1 0 auto;
}

.footer {
  flex-shrink: 0;
  width: 100%;
  background-color: black; /* keep footer black */
  color: white;
  position: relative; /* no fixed, just normal flow */
  bottom: 0;
  left: 0;
}
.footer {
  width: 100%;
  background-color: black;
  color: white;
  position: relative;
  bottom: 0;
  left: 0;
  padding: 10px 0;
  display: flex;
  justify-content: center;
  border-top-left-radius: 30px;
  border-top-right-radius: 30px;
  /* you can increase radius for more roundness */
}

.footer-nav {
  display: flex;
  gap: 40px;
}

.footer-link {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  color: white;
  font-size: 14px;
  font-weight: 500;
}

.footer-icon {
  width: 24px;
  height: 24px;
  margin-bottom: 5px;
  stroke-width: 2;
}

/* Home icon - white */
.footer-link[href="/home"] .footer-icon {
  stroke: white;
}

/* Contact icon - cyan */
.footer-link[href="/contact"] .footer-icon {
  stroke: cyan;
}

/* Cashouts icon - light green */
.footer-link[href="/cashouts"] .footer-icon {
  stroke: lightgreen;
}
.footer {
  width: 100%;
  background-color: #121212;  /* dark but not pure black */
  color: #eee;
  position: relative;
  bottom: 0;
  left: 0;
  padding: 15px 0;
  display: flex;
  justify-content: center;
  border-top-left-radius: 50px;   /* bigger radius for smooth curve */
  border-top-right-radius: 50px;
  box-shadow: 0 -4px 15px rgba(0,0,0,0.5);  /* subtle shadow for depth */
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  user-select: none;
  z-index: 100;
}

.footer-nav {
  display: flex;
  gap: 50px;
}

.footer-link {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  color: #eee;
  font-size: 14px;
  font-weight: 600;
  transition: color 0.3s ease;
}

.footer-link:hover {
  color: #1db954;  /* nice green hover */
}

.footer-icon {
  width: 26px;
  height: 26px;
  margin-bottom: 6px;
  stroke-width: 2.5;
  transition: stroke 0.3s ease;
}

/* Icon colors */
.footer-link[href="/home"] .footer-icon {
  stroke: white;
}
.footer-link[href="/contact"] .footer-icon {
  stroke: cyan;
}
.footer-link[href="/cashouts"] .footer-icon {
  stroke: lightgreen;
}

/* On hover, brighten icons */
.footer-link:hover .footer-icon {
  stroke-opacity: 1;
  filter: brightness(1.2);
}
.footer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #121212;
  color: #eee;
  padding: 15px 0;
  display: flex;
  justify-content: center;
  border-top-left-radius: 50px;
  border-top-right-radius: 50px;
  box-shadow: 0 -4px 15px rgba(0,0,0,0.5);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  user-select: none;
  z-index: 10000;
  transition: height 0.3s ease, padding 0.3s ease;
  overflow: hidden;
  height: 60px; /* collapsed height */
  cursor: pointer;
}

.footer.expanded {
  height: 180px; /* expanded height */
  padding: 20px 0;
  cursor: default;
}

.footer-nav {
  display: flex;
  gap: 50px;
  align-items: center;
  justify-content: center;
  height: 100%;
  opacity: 1;
  transition: opacity 0.3s ease;
}

.footer.expanded .footer-nav {
  opacity: 1;
}

.footer.collapsed .footer-nav {
  opacity: 0;
  pointer-events: none;
}
</style>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Earnify</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="header-wrapper">
    <header>
      <div class="logo-container">
        <div class="logo">$</div>
        <div class="site-name">Earnify</div>
      </div>
      <button class="balance-btn" tabindex="0">LOADING</button>
    </header>
  </div>

  <div class="main">
    <div class="sections" role="tablist" aria-label="Main navigation tabs">
      <div class="section active" data-tab="make-money" tabindex="0" role="tab" aria-selected="true" aria-controls="make-money-content" id="make-money-tab">
        <span class="section-icon make-money-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="18" height="18" rx="6" ry="6"/>
            <text x="12" y="17" text-anchor="middle" font-size="14" font-weight="700" fill="#121212" font-family="Arial, sans-serif">$</text>
          </svg>
        </span>
        <span>Make Money</span>
      </div>
      <div class="section" data-tab="cashout" tabindex="0" role="tab" aria-selected="false" aria-controls="cashout-content" id="cashout-tab">
        <span class="section-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 7l5-5m0 0l5 5m-5-5v18" />
            <path d="M17 17l-5 5m0 0l-5-5m5 5V3" />
          </svg>
        </span>
        <span>Cashout</span>
      </div>
    </div>

    <main>
      <section id="make-money-content" role="tabpanel" aria-labelledby="make-money-tab">
        <h1>Make Money</h1>
        <div id="task-container"></div>
      </section>
      <section id="cashout-content" role="tabpanel" aria-labelledby="cashout-tab" hidden>
        <h1>Cashout</h1>
        <label for="provider-select" style="display:block; margin-top:1em;">Choose payment method:</label>
        <select id="provider-select" style="width:100%; padding:10px; margin-top:6px; border-radius:8px; border:none; background:#1e1e1e; color:#eee;">
          <option value="">-- Select Provider --</option>
          <option value="paypal">PayPal</option>
          <option value="bank">Bank Transfer</option>
          <option value="payoneer">Payoneer</option>
          <option value="amazon">Amazon Gift Card</option>
          <option value="bitcoin">Bitcoin</option>
          <option value="usdd">USDD</option>
        </select>
        <div id="cashout-form" style="margin-top: 20px;"></div>
      </section>
    </main>
  </div>

  <div id="loader-overlay">
    <div class="grid-loader">
      <div class="block"></div>
      <div class="block"></div>
      <div class="block"></div>
      <div class="block"></div>
      <div class="block"></div>
      <div class="block"></div>
      <div class="block"></div>
      <div class="block"></div>
      <div class="block"></div>
    </div>
    <div class="icon"></div>
    <div class="text">Building your earnings...</div>
  </div>

  <div id="customAlertBackdrop">
    <div id="customAlert">
      <div id="customAlertMessage"></div>
      <button class="close-btn" onclick="closeAlert()">Close</button>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-nav">
      <!-- Home -->
      <a href="/home" class="footer-link">
        <svg class="footer-icon" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 12l9-9 9 9" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M9 21V9h6v12" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Home</span>
      </a>

      <!-- Contact -->
      <a href="/contact" class="footer-link">
        <svg class="footer-icon" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 10c0 6-9 13-9 13S3 16 3 10a9 9 0 1 1 18 0z" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="10" r="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Contact</span>
      </a>

      <!-- Cashouts -->
      <a href="/cashouts" class="footer-link">
        <svg class="footer-icon" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Cashouts</span>
      </a>
    </div>
  </footer>
</body>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
  import { getDatabase, ref, onValue, push, serverTimestamp, runTransaction } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.firebasestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // UI references
  const balanceBtn = document.querySelector('.balance-btn');
  const providerSelect = document.getElementById('provider-select');
  const formContainer = document.getElementById('cashout-form');
  const taskContainer = document.getElementById('task-container');

  let currentUser = null;
  let userBalanceRef = null;

  // --- Balance UI updates ---
  function updateBalanceUI(balance) {
    balanceBtn.textContent = `$${(balance || 0).toFixed(2)}`;
  }

  function resetUIForLogout() {
    updateBalanceUI(0);
    formContainer.innerHTML = '';
    providerSelect.value = '';
    taskContainer.innerHTML = '<p>Please log in to see tasks.</p>';
  }

  // --- Cashout form templates ---
  const formTemplates = {
    paypal: {
      min: 10,
      max: 100,
      html: `
        <label>Withdraw Amount <span class="required">*</span>:</label>
        <input type="number" id="amount" placeholder="e.g. 25" required />
        <label>Email <span class="required">*</span>:</label>
        <input type="email" id="email" required />
        <label>Confirm Email <span class="required">*</span>:</label>
        <input type="email" id="confirmEmail" required />
      `
    },
    bank: {
      min: 15,
      max: 500,
      html: `
        <label>Withdraw Amount <span class="required">*</span>:</label>
        <input type="number" id="amount" required />
        <label>Name and surname <span class="required">*</span>:</label>
        <input type="text" id="fname" required />
        <label>Email <span class="required">*</span>:</label>
        <input type="email" id="email" required />
        <label>Account Number <span class="required">*</span>:</label>
        <input type="text" id="account" required />
        <label>Bank Name <span class="required">*</span>:</label>
        <input type="text" id="bank" required />
        <label>Country <span class="required">*</span>:</label>
        <input type="text" id="country" required />
        `
    },
    payoneer: {
      min: 20,
      max: 250,
      html: `
        <label>Withdraw Amount <span class="required">*</span>:</label>
        <input type="number" id="amount" required />
        <label>Payoneer Email <span class="required">*</span>:</label>
        <input type="email" id="email" required />
      `
    },
    amazon: {
      min: 5,
      max: 100,
      html: `
        <label>Withdraw Amount <span class="required">*</span>:</label>
        <input type="number" id="amount" required />
        <label>Email for Gift Card <span class="required">*</span>:</label>
        <input type="email" id="email" required />
      `
    },
    bitcoin: {
      min: 20,
      max: 300,
      html: `
        <label>Withdraw Amount <span class="required">*</span>:</label>
        <input type="number" id="amount" required />
        <label>Bitcoin Wallet Address <span class="required">*</span>:</label>
        <input type="text" id="wallet" required />
      `
    },
    usdd: {
      min: 20,
      max: 300,
      html: `
        <label>Withdraw Amount <span class="required">*</span>:</label>
        <input type="number" id="amount" required />
        <label>TRC20 Wallet Address <span class="required">*</span>:</label>
        <input type="text" id="wallet" required />
      `
    }
  };

  // --- Load tasks from Firebase and render with anti-cheat 20-sec timer ---
  function loadTasks() {
    if (!currentUser) {
      taskContainer.innerHTML = '<p>Please log in to see tasks.</p>';
      return;
    }
    const tasksRef = ref(db, 'tasks');
    onValue(tasksRef, snapshot => {
      const tasks = snapshot.val();
      if (!tasks) {
        taskContainer.innerHTML = '<p>No tasks available.</p>';
        return;
      }
      taskContainer.innerHTML = '';
      const taskEntries = Object.entries(tasks).slice(0, 10);
      taskEntries.forEach(([taskId, task]) => {
        const taskEl = document.createElement('div');
        taskEl.className = 'task-card';
        taskEl.style.cssText = `
          display: flex;
          align-items: center;
          border: 1px solid #444;
          padding: 12px;
          margin-bottom: 12px;
          border-radius: 8px;
          background: #1e1e1e;
        `;

        // Image left
        const img = document.createElement('img');
        img.src = task.image;
        img.alt = task.title;
        img.style.cssText = `
          width: 120px;
          height: 90px;
          object-fit: cover;
          border-radius: 6px;
          margin-right: 16px;
          flex-shrink: 0;
        `;

        // Right content
        const rightDiv = document.createElement('div');
        rightDiv.style.flex = '1';

        const title = document.createElement('h3');
        title.textContent = task.title;
        title.style.margin = '0 0 6px 0';

        const desc = document.createElement('p');
        desc.textContent = task.description;
        desc.style.margin = '0 0 8px 0';
        desc.style.color = '#22d3ee';

        const bottomDiv = document.createElement('div');
        bottomDiv.style.display = 'flex';
        bottomDiv.style.flexDirection = 'column';   // stack vertically
        bottomDiv.style.alignItems = 'flex-start';  // left align
        bottomDiv.style.gap = '8px';                 // spacing between reward and button
        
        const reward = document.createElement('span');
        reward.textContent = `Reward: $${task.amount.toFixed(2)}`;
        reward.style.fontWeight = '600';
        reward.style.color = '#1a8917';

        const btn = document.createElement('button');
        btn.textContent = 'Complete Task';
        btn.style.padding = '6px 14px';
        btn.style.border = 'none';
        btn.style.backgroundColor = '#2563eb';
        btn.style.color = 'white';
        btn.style.borderRadius = '4px';
        btn.style.cursor = 'pointer';

        btn.addEventListener('click', () => {
          if (!currentUser) {
            alert('Please log in to complete tasks.');
            return;
          }
          const userId = currentUser.uid;
          const clickedTasksKey = `clickedTasks_${userId}`;
          const now = Date.now();

          // Load clicked tasks info from localStorage or default
          let clickedTasks = {};
          try {
            clickedTasks = JSON.parse(localStorage.getItem(clickedTasksKey)) || {};
          } catch {
            clickedTasks = {};
          }

        if (clickedTasks[taskId]?.completed) {
         showAlert('You have already completed this task and received the reward.', 'error');
           window.open(task.url, '_blank');
            return;
          }

          // If a timer is running and not passed 20 seconds, deny reward
          if (clickedTasks[taskId]?.clickTimestamp) {
            const elapsed = now - clickedTasks[taskId].clickTimestamp;
            if (elapsed < 20000) {
              alert(`Please stay on the task page for at least 20 seconds to earn the reward. Wait ${Math.ceil((20000 - elapsed) / 1000)} more seconds.`);
              window.open(task.url, '_blank');
              return;
            }
          }

          // Register click timestamp
          clickedTasks[taskId] = {
            clickTimestamp: now,
            completed: false
          };
          localStorage.setItem(clickedTasksKey, JSON.stringify(clickedTasks));

          // Save click to Firebase for tracking
          const clicksRef = ref(db, `taskClicks/${userId}/${taskId}`);
          push(clicksRef, {
            timestamp: serverTimestamp()
          });

          // Open the task URL in a new tab/window
          const newWindow = window.open(task.url, '_blank');

          // Start a timer to check if user returns after 20 seconds
          const checkInterval = setInterval(() => {
            // If window closed, check if 20 seconds passed
            if (newWindow.closed) {
              clearInterval(checkInterval);
              const clickData = JSON.parse(localStorage.getItem(clickedTasksKey)) || {};
              const clickTime = clickData[taskId]?.clickTimestamp || 0;
              const elapsedTime = Date.now() - clickTime;

              if (elapsedTime >= 20000 && !clickData[taskId]?.completed) {
                // Add reward to user balance
                const userBalanceRef = ref(db, `users/${userId}/balance`);
                runTransaction(userBalanceRef, currentBalance => {
                  if (currentBalance === null) return task.amount;
                  return currentBalance + task.amount;
                }).then(() => {
                  // Mark task as completed locally
                  clickData[taskId].completed = true;
                  localStorage.setItem(clickedTasksKey, JSON.stringify(clickData));
               showAlert(`Congrats! You earned $${task.amount.toFixed(2)} for completing the task "${task.title}".`);
                }).catch(err => {
                  console.error('Error updating balance:', err);
                  showAlert('An error occurred while updating your balance.', 'error');
                });
              } else if (elapsedTime < 20000) {
                showAlert('You did not stay on the task page long enough. No reward granted.', 'error');
              }
            }
          }, 1000);
        });

        bottomDiv.appendChild(reward);
        bottomDiv.appendChild(btn);

        rightDiv.appendChild(title);
        rightDiv.appendChild(desc);
        rightDiv.appendChild(bottomDiv);

        taskEl.appendChild(img);
        taskEl.appendChild(rightDiv);

        taskContainer.appendChild(taskEl);
      });
    });
  }

  // --- Auth state changes ---
  onAuthStateChanged(auth, user => {
    currentUser = user;
    if (user) {
      // Setup balance listener
      userBalanceRef = ref(db, `users/${user.uid}/balance`);
      onValue(userBalanceRef, snapshot => {
        const balance = snapshot.val();
        updateBalanceUI(balance);
      });
      loadTasks();
    } else {
      resetUIForLogout();
    }
  });

  // --- Cashout provider selection ---
  providerSelect.addEventListener('change', () => {
    const selected = providerSelect.value;
    if (!selected) {
      formContainer.innerHTML = '';
      return;
    }
    const { html } = formTemplates[selected];
    formContainer.innerHTML = `
      <form id="cashoutRequestForm">
        ${html}
        <button type="submit" class="submit-btn">Confirm Cashout</button>
        <small id="form-error" style="color:#f87171; display:none; margin-top:8px;"></small>
      </form>
    `;
  });

  // --- Cashout form submit handler ---
  formContainer.addEventListener('submit', async function (e) {
    if (!e.target.matches('#cashoutRequestForm')) return;
    e.preventDefault();
    if (!currentUser) {
      alert("Please log in to request a cashout.");
      return;
    }

    const selected = providerSelect.value;
    const form = e.target;
    const fields = form.querySelectorAll('input[required]');
    const errorMsg = form.querySelector('#form-error');
    const amountInput = form.querySelector('#amount');
    const amount = parseFloat(amountInput?.value);
    const { min, max } = formTemplates[selected];

    // Validation
    let allFilled = true;
    fields.forEach(f => {
      if (!f.value.trim()) {
        allFilled = false;
      }
    });
    if (!allFilled) {
      errorMsg.textContent = 'Please fill in all required fields.';
      errorMsg.style.display = 'block';
      return;
    }
    if (isNaN(amount) || amount < min || amount > max) {
      errorMsg.textContent = `Amount must be between $${min} and $${max}.`;
      errorMsg.style.display = 'block';
      return;
    }
    if (selected === 'paypal') {
      const email = form.querySelector('#email').value.trim();
      const confirmEmail = form.querySelector('#confirmEmail').value.trim();
      if (email.toLowerCase() !== confirmEmail.toLowerCase()) {
        errorMsg.textContent = "Email and Confirm Email do not match.";
        errorMsg.style.display = 'block';
        return;
      }
    }
    errorMsg.style.display = 'none';

    try {
      // Deduct balance transactionally
      const userBalanceRef = ref(db, `users/${currentUser.uid}/balance`);
      const cashoutRequestsRef = ref(db, `cashoutRequests`);

      const transactionResult = await runTransaction(userBalanceRef, currentBalance => {
        if (currentBalance === null || currentBalance < amount) {
          // Not enough balance, abort transaction
          return;
        }
        // Deduct the requested amount
        return currentBalance - amount;
      });

      if (!transactionResult.committed) {
        errorMsg.textContent = 'Insufficient balance to complete cashout.';
        errorMsg.style.display = 'block';
        return;
      }

      // Save cashout request details
      try {
        const newRequestRef = push(cashoutRequestsRef);
        await newRequestRef.set({
          userId: currentUser.uid,
          provider: selected,
          amount: amount,
          timestamp: serverTimestamp(),
          status: 'pending'
        });
      } catch (saveError) {
        console.error('Error saving cashout request:', saveError);

        // Refund balance if saving request fails
        await runTransaction(userBalanceRef, currentBalance => {
          if (currentBalance === null) return amount;
          return currentBalance + amount;
        });

        errorMsg.textContent = 'Failed to submit cashout request. Your balance has been refunded. Please try again.';
        errorMsg.style.display = 'block';
        return;
      }

      alert('Cashout request submitted successfully!');
      form.reset();
      providerSelect.value = '';
      formContainer.innerHTML = '';

    } catch (error) {
      console.error('Cashout request error:', error);
      errorMsg.textContent = 'An error occurred while submitting your request. Please try again.';
      errorMsg.style.display = 'block';
    }
  });

  // Hide loader after 5 seconds
  setTimeout(() => {
    const loader = document.getElementById('loader-overlay');
    loader.classList.add('fade-out');
  }, 5000);

  const makeMoneyTabBtn = document.getElementById('make-money-tab');
  const cashoutTabBtn = document.getElementById('cashout-tab');
  const makeMoneyContent = document.getElementById('make-money-content');
  const cashoutContent = document.getElementById('cashout-content');

  makeMoneyTabBtn.addEventListener('click', () => {
    makeMoneyContent.removeAttribute('hidden');
    cashoutContent.setAttribute('hidden', '');
  });

  cashoutTabBtn.addEventListener('click', () => {
    cashoutContent.removeAttribute('hidden');
    makeMoneyContent.setAttribute('hidden', '');
  });

  makeMoneyTabBtn.addEventListener('click', () => {
    makeMoneyContent.removeAttribute('hidden');
    cashoutContent.setAttribute('hidden', '');

    makeMoneyTabBtn.classList.add('active');
    cashoutTabBtn.classList.remove('active');
  });

  cashoutTabBtn.addEventListener('click', () => {
    cashoutContent.removeAttribute('hidden');
    makeMoneyContent.setAttribute('hidden', '');

    cashoutTabBtn.classList.add('active');
    makeMoneyTabBtn.classList.remove('active');
  });

  function showAlert(message, type = 'success') {
    const backdrop = document.getElementById('customAlertBackdrop');
    const alertBox = document.getElementById('customAlert');
    const messageDiv = document.getElementById('customAlertMessage');

    messageDiv.textContent = message;

    alertBox.classList.remove('success', 'error');
    alertBox.classList.add(type);
    alertBox.classList.add('show');

    backdrop.style.display = 'flex';
  }

  window.closeAlert = function() {
    const backdrop = document.getElementById('customAlertBackdrop');
    const alertBox = document.getElementById('customAlert');

    alertBox.classList.remove('show');
    backdrop.style.display = 'none';
  };

  function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }

  if (!isMobileDevice()) {
    document.head.innerHTML = `
      <style>
        body, html {
          margin: 0; padding: 0; height: 100%; width: 100%;
          display: flex; justify-content: center; align-items: center;
          background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
          color: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                       Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
          user-select: none;
        }
        .block-container {
          text-align: center;
          max-width: 400px;
          padding: 20px;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 15px;
          box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
          backdrop-filter: blur(8px);
          -webkit-backdrop-filter: blur(8px);
        }
        h1 {
          font-size: 2.5rem;
          margin-bottom: 1rem;
        }
        p {
          font-size: 1.2rem;
          opacity: 0.8;
          line-height: 1.5;
        }
      </style>
    `;

    document.body.innerHTML = `
      <div class="block-container">
        <h1>Access Denied</h1>
        <p>This website is only accessible on mobile devices.</p>
      </div>
    `;
  }
</script>
</body>
</html>
